<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    *{
      padding: 0;
      margin: 0;
      box-sizing: border-box;
    }

    body{
      height: 100vh;

      font-family: Arial, Helvetica, sans-serif;
      display: flex;
      justify-content: center;
    }

    .speech_to_text{
      padding: 1rem;

      display: flex;
      flex-direction: column;
      gap: 0.5rem;  
    }
  </style>
</head>
<body>
  <div class="speech_to_text">
    <h1>Speech to Text</h1>
    <textarea name="" id="convert_text"></textarea>
    <button id="click_to_convert">Speech to Text</button>
  </div>

  <script>
    const click_to_convert = document.getElementById("click_to_convert");
    const convert_text = document.getElementById("convert_text");

    click_to_convert.addEventListener("click", () => {
      // Create SpeechRecognition Object
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      recognition.lang = 'en-GB';

      // Edit Settings to display non-final results (aka interimResults)
      recognition.interimResults = true;

      recognition.addEventListener("result", (element) => {
        /* The "result" event is triggered whenever the speech recognition system processes audio 
        and generates a recognition result. element is a parameter that we created.
        element.results stores all recognition results. However, it is not an Array, but an "Array-like object".
        Hence, we convert it to an Array first using Array.from(), as we want to use the Array method .map() later.

        result is an array of possible interpretations for one segment of speech, with result[0] containing the most probable word.
        Hence, we want our new array, transcript, to contain result[0] only, so we use .map() to map the value from result to transcript.
        However, result[0] looks like this: { transcript: 'Hello', confidence: 0.95 }.
        Thus, we do .map(result => result[0].transcript) as we actually want result[0].transcript.

        Now, transcript is just an Array with individual words, eg: ["I", "love", "JavaScript"].
        Since we want to change the value of the textarea, we need a string, not an Array.
        Thus, we use .join(''), as it joins all elements in an Array into a string, 
        applying an empty string (which is equivalent to a space) as the seperator between each element of transcript.
        eg: ["I", "love", "JavaScript"] => "I love JavaScript"
        */
        const transcript = Array.from(element.results).map(result => result[0].transcript).join('');


        // Update the textarea with live transcription
        convert_text.value = transcript;
      });

      recognition.start(); // Start speech recognition
    });
  </script>
</body>
</html>
